<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>method_part_barplots</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Guidelines on Building Coexpression Networks from RNA-seq Data</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="gtex_plots.html">GTEx Results</a>
</li>
<li>
  <a href="sra_plots.html">SRA Results</a>
</li>
<li>
  <a href="gtex_resampling_plots.html">GTEx Resampling</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">method_part_barplots</h1>

</div>


<pre class="r"><code>cpm_methods &lt;- c(&quot;CPM&quot;, &quot;CPM_QNT&quot;, &quot;CPM_CLR&quot;, &quot;CPM_QNT_CLR&quot;, &quot;CPM_WTO&quot;, &quot;CPM_QNT_WTO&quot;)
rpkm_methods &lt;- c(&quot;RPKM&quot;, &quot;RPKM_QNT&quot;, &quot;RPKM_CLR&quot;, &quot;RPKM_QNT_CLR&quot;, &quot;RPKM_WTO&quot;, &quot;RPKM_QNT_WTO&quot;)
tpm_methods &lt;- c(&quot;TPM&quot;, &quot;TPM_QNT&quot;, &quot;TPM_CLR&quot;, &quot;TPM_QNT_CLR&quot;, &quot;TPM_WTO&quot;, &quot;TPM_QNT_WTO&quot;)
no_wi_methods &lt;- c(&quot;counts&quot;, &quot;QNT&quot;, &quot;CLR&quot;, &quot;QNT_CLR&quot;, &quot;WTO&quot;, &quot;QNT_WTO&quot;)

tmm_methods &lt;- c(&quot;TMM&quot;, &quot;TMM_CLR&quot;, &quot;TMM_WTO&quot;)
uq_methods &lt;- c(&quot;UQ&quot;, &quot;UQ_CLR&quot;, &quot;UQ_WTO&quot;)
quantile_methods &lt;- c(&quot;QNT&quot;, &quot;QNT_CLR&quot;, &quot;QNT_WTO&quot;)
no_bw_methods &lt;- c(&quot;counts&quot;, &quot;CLR&quot;, &quot;WTO&quot;)

clr_methods &lt;- c(&quot;CLR&quot;, &quot;CPM_CLR&quot;, &quot;RPKM_CLR&quot;, &quot;TPM_CLR&quot;,
                 &quot;QNT_CLR&quot;, &quot;TMM_CLR&quot;, &quot;UQ_CLR&quot;,
                 &quot;CPM_QNT_CLR&quot;, &quot;TPM_QNT_CLR&quot;, &quot;RPKM_QNT_CLR&quot;)
wto_methods &lt;- c(&quot;WTO&quot;, &quot;CPM_WTO&quot;, &quot;RPKM_WTO&quot;, &quot;TPM_WTO&quot;,
                 &quot;QNT_WTO&quot;, &quot;TMM_WTO&quot;, &quot;UQ_WTO&quot;,
                 &quot;CPM_QNT_WTO&quot;, &quot;TPM_QNT_WTO&quot;, &quot;RPKM_QNT_WTO&quot;)
no_nt_methods &lt;- c(&quot;counts&quot;, &quot;CPM&quot;, &quot;TPM&quot;, &quot;RPKM&quot;,
                   &quot;TMM&quot;, &quot;UQ&quot;, &quot;QNT&quot;,
                   &quot;CPM_QNT&quot;, &quot;TPM_QNT&quot;, &quot;RPKM_QNT&quot;)

single_method_meta &lt;- tibble(group = c(&quot;cpm&quot;, &quot;rpkm&quot;, &quot;tpm&quot;, &quot;no_wi&quot;,
                                          &quot;tmm&quot;, &quot;uq&quot;, &quot;qnt&quot;, &quot;no_bw&quot;,
                                          &quot;clr&quot;, &quot;wto&quot;,&quot;no_nt&quot;),
                                length = c(6, 6, 6, 6,
                                           3, 3, 3, 3,
                                           10, 10, 10),
                                type = c(&quot;within&quot;, &quot;within&quot;, &quot;within&quot;, &quot;within&quot;,
                                         &quot;between&quot;, &quot;between&quot;, &quot;between&quot;, &quot;between&quot;,
                                         &quot;transformation&quot;, &quot;transformation&quot;, &quot;transformation&quot;))</code></pre>
<div id="functions" class="section level1">
<h1>Functions</h1>
<pre class="r"><code>#functions to build plots
get_times_greater_than_matrix &lt;- function(meth_df){
  #df should be methods_* df (each row is performance on given dataset)
  counts_output &lt;- matrix(rep(0, 900), nrow = 30, ncol = 30)
  colnames(counts_output) &lt;- colnames(meth_df)
  rownames(counts_output) &lt;- colnames(meth_df)
  
  for(num in 1:30){
  a &lt;- pull(meth_df, num)
  for(val in 1:30){
    if (num == val){
      counts_output[val, num] &lt;- 0.5
      next
    }
    b &lt;- pull(meth_df, val)
    s &lt;- sum(a &lt; b)
    s &lt;- s/nrow(meth_df)
    counts_output[val, num] &lt;- s
  }
  }
  return(counts_output)
}

get_significance_matrix &lt;- function(df, performance_col_position, method_col_position){
  #df tidy format with method as a column and performance as a column
  sig_output &lt;- pairwise.wilcox.test(x = pull(df, performance_col_position),
                                     g = pull(df, method_col_position),
                                     paired = TRUE,
                                     p.adjust.method = &quot;BH&quot;)$p.value
  
  #add row/col to make 30 by 30
  CLR &lt;- sig_output[1,]
  CLR[1] &lt;- NA
  sig_output &lt;- rbind(CLR, sig_output)
  WTO &lt;- sig_output[,29]
  WTO[30] &lt;- NA
  sig_output &lt;- cbind(sig_output, WTO)
  
  #make symmetric
  diag(sig_output) &lt;- 1
  sig_output &lt;- Matrix::forceSymmetric(sig_output, uplo = &quot;L&quot;)
  sig_output &lt;- as.matrix(sig_output)
  #replace p vals with sig/not sig
  sig_wilcox_gtex_naive &lt;- ifelse(sig_output &lt; 0.01, &quot;*&quot;, &quot; &quot;)
}

get_method_part_prop_sig_greater &lt;- function(times_matrix, sig_matrix){
  #times_matrix is output of get_times_greater_than_matrix
  #sig_matrix is output of get_significance_matrix
  #make times_matrix into tibble and get times method_one &gt; method_two
  times_greater_than_tibble &lt;- as_tibble(times_matrix)
  times_greater_than_tibble$method_one &lt;- colnames(times_matrix)
  times_greater_than_tibble &lt;- times_greater_than_tibble %&gt;% 
    gather(key = method_two, value = times_method_one_is_greater_than_method_two, 1:30)
  #make sig_matrix into tibble and get times corrected wilcox p value was
  #significant between method_one and method_two
  sig_wilcox_tibble &lt;-  as_tibble(sig_matrix)
  sig_wilcox_tibble$method_one &lt;- colnames(sig_matrix)
  sig_wilcox_tibble &lt;- sig_wilcox_tibble %&gt;%
    gather(key = method_two, value = significance, 1:30)
  sig_wilcox_tibble$significance &lt;- ifelse(sig_wilcox_tibble$significance == &quot;*&quot;,
                                           T, F)
  
  #join above two tibbles into one
  greater_than_significance_tibble &lt;- left_join(times_greater_than_tibble,
                                                sig_wilcox_tibble,
                                                by = c(&quot;method_one&quot;, &quot;method_two&quot;))
  #make T/F column designating whether method_one &gt; method_two AND significant by 
  #corrected wilcox p value
  greater_than_significance_tibble$method_one_greater_than_and_sig &lt;-
    ifelse(greater_than_significance_tibble$times_method_one_is_greater_than_method_two &gt; 0.5 &amp;
       greater_than_significance_tibble$significance == T, T, F)
  #summarize above info by method
  method_summary &lt;- greater_than_significance_tibble %&gt;%
    group_by(method_one) %&gt;% 
    summarise(times_sig_and_greater = sum(method_one_greater_than_and_sig))
  #change col name from method_one to method
  colnames(method_summary) &lt;- c(&quot;method&quot;, &quot;times_sig_and_greater&quot;)
  
  #turn method_summary into method_parts summary
  #here down where function modified from heatmap (all_heatmap_plots.rmd) get_method_times_sig_greater function
  #create T/F columns for each method part (does a method have the given method part?)
  #wi
  method_summary$cpm &lt;- method_summary$method %in% cpm_methods
  method_summary$tpm &lt;- method_summary$method %in% tpm_methods
  method_summary$rpkm &lt;- method_summary$method %in% rpkm_methods
  method_summary$no_wi &lt;- method_summary$method %in% no_wi_methods
  #bw
  method_summary$tmm &lt;- method_summary$method %in% tmm_methods
  method_summary$uq &lt;- method_summary$method %in% uq_methods
  method_summary$qnt &lt;- method_summary$method %in% quantile_methods
  method_summary$no_bw &lt;- method_summary$method %in% no_bw_methods
  #nt
  method_summary$wto &lt;- method_summary$method %in% wto_methods
  method_summary$clr &lt;- method_summary$method %in% clr_methods
  method_summary$no_nt &lt;- method_summary$method %in% no_nt_methods
  
  #gather T/F method columns into method column/one T/F column
  #keep only true rows so group col reflects methods actually in group
  #don&#39;t need membership col anymore (all TRUEs anyway)
  #group by group (method part)
  #sum times sig and greater for each method in method part group
  method_summary &lt;- method_summary %&gt;% 
    gather(3:13, key = group, value = membership) %&gt;% 
    filter(membership == T) %&gt;% 
    select(-membership) %&gt;% 
    group_by(group) %&gt;% 
    summarise(times_sig_and_greater = sum(times_sig_and_greater))
  
  #add to single_method_meta so we know how many methods are in each group
  method_summary &lt;- left_join(method_summary, single_method_meta, by = &quot;group&quot;)
  
  #divide number of times sig and greater by number of chances they had (determined by group length)
  method_summary &lt;- method_summary %&gt;% 
    mutate(divisor = length * 29) %&gt;% 
    mutate(prop_times_sig_and_greater = times_sig_and_greater/divisor)
  
  #gives better names for plot
  method_summary$group &lt;- toupper(method_summary$group)
  method_summary$group &lt;- gsub(&quot;NO_BW&quot;, &quot;NO-BW&quot;, method_summary$group)
  method_summary$group &lt;- gsub(&quot;NO_WI&quot;, &quot;NO-WI&quot;, method_summary$group)
  method_summary$group &lt;- gsub(&quot;NO_NT&quot;, &quot;NO-NT&quot;, method_summary$group)
  
  return(method_summary)
}</code></pre>
<p>#GTEX ## log<sub>2</sub>(auPRC/prior)</p>
<pre class="r"><code>#naive plot matrices
l2_auprc_prior_gtex_naive_times_mat &lt;- get_times_greater_than_matrix(methods_gn_auprc_prior)
l2_auprc_prior_gtex_naive_sig_mat &lt;- get_significance_matrix(gnr, method_col_position = 3, performance_col_position = 4)
l2_auprc_prior_gtex_naive_method_part_summary &lt;- get_method_part_prop_sig_greater(times_matrix = l2_auprc_prior_gtex_naive_times_mat,
                                                                                  sig_matrix =l2_auprc_prior_gtex_naive_sig_mat)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>#knowledge plot matrices
l2_auprc_prior_gtex_knowledge_times_mat &lt;- get_times_greater_than_matrix(methods_gk_auprc_prior)
l2_auprc_prior_gtex_knowledge_sig_mat &lt;- get_significance_matrix(gkr, method_col_position = 3, performance_col_position = 4)
l2_auprc_prior_gtex_knowledge_method_part_summary &lt;- get_method_part_prop_sig_greater(l2_auprc_prior_gtex_knowledge_times_mat,
                                                                                  l2_auprc_prior_gtex_knowledge_sig_mat)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>#naive plot
l2_auprc_prior_gtex_naive_method_part_summary %&gt;% 
  ggplot(aes(x = group, y = prop_times_sig_and_greater, fill = group)) +
  geom_hline(yintercept = 0.25, color = &quot;#999999&quot;, size = 0.1) +
  geom_hline(yintercept = 0.5, color = &quot;#999999&quot;, size = 0.1) +
  geom_hline(yintercept = 0.75, color = &quot;#999999&quot;, size = 0.1) +
  geom_hline(yintercept = 1, color = &quot;#999999&quot;, size = 0.1) +
  #geom_segment(aes(x = 3.5, xend = 3.5, y = -0.25, yend = 0)) +
  #annotate(&quot;segment&quot;, x=3.5, y=0.25, xend=3.5, yend=0,
  #             col=&quot;red&quot;, arrow=arrow(length=unit(0.3, &quot;cm&quot;))) +
  geom_col() +
  annotation_custom(grob = textGrob(label = &quot;text&quot;, hjust = 0, gp = gpar(cex = 1.5)),
                    ymin = 3.5, ymax = 4, xmin = 3, xmax = 5) +
  scale_x_discrete(limits = c(&quot;WTO&quot;, &quot;CLR&quot;, &quot;NO-NT&quot;,
                              &quot;UQ&quot;, &quot;TMM&quot;, &quot;QNT&quot;,&quot;NO-BW&quot;,
                              &quot;TPM&quot;, &quot;RPKM&quot;, &quot;CPM&quot;, &quot;NO-WI&quot;)) +
  scale_fill_manual(values = c(&quot;WTO&quot; = &quot;#fd8d3c&quot;, &quot;CLR&quot; = &quot;#fdbe85&quot;, &quot;NO-NT&quot; = &quot;#feedde&quot;,
                              &quot;QNT&quot; = &quot;#bae4b3&quot;, &quot;UQ&quot; = &quot;#238b45&quot;, &quot;TMM&quot; = &quot;#74c476&quot;, &quot;NO-BW&quot; = &quot;#edf8e9&quot;,
                              &quot;TPM&quot; = &quot;#2171b5&quot;, &quot;RPKM&quot; = &quot;#6baed6&quot;, &quot;CPM&quot; = &quot;#bdd7e7&quot;, &quot;NO-WI&quot; = &quot;#eff3ff&quot;)) +
  geom_text(aes(label = round(prop_times_sig_and_greater, 2)), hjust = -0.1, color = &quot;#999999&quot;, fontface = &quot;bold&quot;) +
  scale_y_continuous(limits = c(0,1)) +
  coord_flip(clip = &quot;off&quot;) +
  theme(panel.background = element_rect(fill = &quot;white&quot;), 
        panel.grid.minor = element_blank(), 
        panel.grid.major = element_blank(),
        text = element_text(size = 14),
        axis.title = element_blank()) +
  guides(fill = F) </code></pre>
<p><img src="method_part_barplots_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code># barplot_labels &lt;- tibble(group = c(&quot;Within-Sample\nNormalization&quot;, &quot;Between-Sample\nNormalization&quot;, &quot;Network\nTransformation&quot;),
#                          color = c(&quot;#2171b5&quot;, &quot;#238b45&quot;, &quot;#fd8d3c&quot;))
# barplot_labels %&gt;% 
#   ggplot(aes(x = 0.5, y = factor(group, levels = rev(c(&quot;Within-Sample\nNormalization&quot;, &quot;Between-Sample\nNormalization&quot;, &quot;Network\nTransformation&quot;))), 
#              fill = color, label = group))+
#   geom_tile(color = &quot;white&quot;, size = 0.5) +
#   scale_fill_manual(values = barplot_labels$color) +
#   theme(panel.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         axis.text = element_blank(), 
#         axis.ticks = element_blank(),
#         axis.title = element_blank(),
#         
#         plot.margin = margin(5,0.5,5,0.5)) +
#   geom_fit_text() +
#   guides(fill = F)</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
